function initHash(){var a=judHash();packElms(a),getElms().lastHash=a[0],""!==location.hash&&sectionChange(a[0]),window.onhashchange=function(){a=judHash(),packElms(a),sectionAnimate(judHash()[0]),getElms().lastHash=a[0]}}function judHash(){if(""===location.hash)return["index"];var a=location.hash.substring(2);return-1!==a.indexOf("tab")&&-1===a.indexOf("/")?["tab",a.substring(3)]:-1!==a.indexOf("task")?["task",a.substring(a.indexOf("task")+4),a.substring(3,a.lastIndexOf("/"))]:void 0}function packElms(a){var t=getTask();"index"===a[0]?packIndex(t):"tab"===a[0]?packTab(a[1],t):"task"===a[0]&&packTask(a[1],a[2],t)}function packIndex(a){for(var t=getElms().oIndex.getElementsByTagName("ul")[0],e=document.createDocumentFragment(),n=0,s=a.length;s>n;n++){var i=document.createElement("li"),o=document.createElement("a");i.className="item one-tab",o.href="#/tab"+a[n].id,o.innerHTML=a[n].name,i.appendChild(o),e.appendChild(i)}t.innerHTML="",t.appendChild(e)}function packTab(a,t){for(var e=getElms().oTab.getElementsByTagName("ul")[0],n=document.createDocumentFragment(),s=0,i=t.length;i>s;s++)if(t[s].id===parseInt(a)){for(var o=0,d=t[s].children,l=d.length;l>o;o++){var r=document.createElement("li"),c=document.createElement("a");r.className="item one-task",c.href="#/tab"+a+"/task"+d[o].id,c.innerHTML=d[o].name,r.appendChild(c),n.appendChild(r)}break}e.innerHTML="",e.appendChild(n)}function packTask(a,t,e){for(var n=$("#task-name"),s=$("#task-time"),i=$("#task-text"),o=0,d=e.length;d>o;o++)if(e[o].id===parseInt(t))for(var l=0,r=e[o].children,c=r.length;c>l;l++)r[l].id===parseInt(a)&&(n.innerHTML=r[l].name,s.innerHTML=r[l].time,i.innerHTML=r[l].text.replace(/\n/,"<br>"))}function sectionAnimate(a){var t=getElms();removeClass(t.oHtml,"*"),"tab"===a?(addClass(t.oHtml,a+"-from-"+t.lastHash),setTimeout(function(){t.oHtml.className=a+"-now"},400)):(addClass(t.oHtml,a+"-show"),setTimeout(function(){t.oHtml.className=a+"-now"},400))}function sectionChange(a){var t=getElms();t.oHtml.className=a+"-now"}function touchBack(){for(var a=document.querySelectorAll(".touch-to-back"),t=void 0,e=0,n=a.length;n>e;e++)a[e].addEventListener("touchstart",function(){t=this},!1),$("#body").addEventListener("touchend",function(){if(t){var a=t.parentNode;"index"===a.id?location.hash="":"tab"===a.id&&(location.hash=location.hash.substring(0,location.hash.lastIndexOf("/"))),t=void 0}});a=null}function _getElms(){var a=$("html"),t=$("#index"),e=$("#tab"),n=$("#task"),s={oHtml:a,oIndex:t,oTab:e,oTask:n,lastHash:void 0};return function(){return s}}function _getTask(){var a=JSON.parse(localStorage.getItem("task"))||[{name:"任务分类1",id:1,children:[{name:"任务1",id:1,time:"2015-05-10",text:"asdadasdas\nasdas"},{name:"任务2",id:2,time:"2015-05-20",text:"asdadasda"}]},{name:"任务分类2",id:2,children:[{name:"任务1",id:1,time:"2015-05-10",text:"asdadasdas\nasdas"},{name:"任务2",id:2,time:"2015-05-20",text:"asdadasda"}]},{name:"任务分类3a",id:3,children:[{name:"任务1",id:1,time:"2015-05-10",text:"asdadasdas\nasdas"},{name:"任务2",id:2,time:"2015-05-20",text:"asdadasda"}]}];return localStorage.getItem("task")||localStorage.setItem("task",JSON.stringify(a)),function(){return a}}window.onload=function(){initHash(),touchBack()};var getElms=_getElms(),getTask=_getTask();